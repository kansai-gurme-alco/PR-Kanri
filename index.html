<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR管理アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #fce4ec 0%, #f3e5f5 50%, #e3f2fd 100%);
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ロゴ：見切れないための絶対設定 */
        .logo-text {
            font-size: 28px;
            font-weight: 900;
            font-style: italic;
            letter-spacing: -0.05em;
            line-height: 1.2;
            white-space: nowrap; 
            background: linear-gradient(to top right, #f9ce34, #ee2a7b, #6228d7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
            display: inline-block;
            padding-right: 12px;
        }

        .glass {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .active-nav { color: #9333ea; }
        .inactive-nav { color: #9ca3af; }

        .tap-active:active { transform: scale(0.96); transition: 0.1s; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen shadow-2xl relative overflow-hidden bg-white">

    <!-- メインコンテンツエリア -->
    <div id="main-content" class="h-screen overflow-y-auto no-scrollbar pb-24">
        <!-- JSで動的に書き換え -->
    </div>

    <!-- 下部ナビゲーション -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/80 backdrop-blur-lg border-t border-gray-100 flex justify-around items-center py-3 px-4 z-50">
        <button onclick="changeView('home')" id="nav-home" class="flex flex-col items-center gap-1 active-nav">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">ホーム</span>
        </button>
        <button onclick="changeView('calendar')" id="nav-calendar" class="flex flex-col items-center gap-1 inactive-nav">
            <i data-lucide="calendar" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">カレンダー</span>
        </button>
        <button onclick="changeView('list')" id="nav-list" class="flex flex-col items-center gap-1 inactive-nav">
            <i data-lucide="list" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">リスト</span>
        </button>
    </nav>

    <script>
        // --- データ初期化 ---
        let projects = JSON.parse(localStorage.getItem('pr_app_data')) || [
            {
                id: 1,
                shopName: 'サンプルカフェ 渋谷店',
                media: 'Instagram',
                date: new Date().toISOString().split('T')[0],
                time: '12:00',
                status: 'active',
                requests: ['フィード', 'リール'],
                conditions: ['飲食自由', '無償'],
                isDeleted: false
            }
        ];

        let currentView = 'home';
        let editingId = null;
        let listFilter = 'all';
        let calMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
        let selectedDate = new Date().toISOString().split('T')[0];

        const mediaOptions = [
            { name: 'Instagram', color: 'bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600 text-white' },
            { name: 'TikTok', color: 'bg-black text-white' },
            { name: 'Toridori', color: 'bg-gradient-to-r from-pink-500 via-red-400 via-yellow-400 via-green-400 to-blue-500 text-white' },
            { name: 'ユニット', color: 'bg-yellow-300 text-gray-800' }
        ];

        const statusOptions = [
            { label: '条件交渉中', value: 'negotiating', color: 'bg-blue-100 text-blue-600' },
            { label: '来店予定', value: 'active', color: 'bg-purple-100 text-purple-600' },
            { label: '完了', value: 'completed', color: 'bg-green-100 text-green-600' },
            { label: '頓挫', value: 'cancelled', color: 'bg-red-100 text-red-600' }
        ];

        const requestOptions = ['フィード', 'リール', 'Google', 'タイアップ', 'インサイト', '食べログ', 'リンク', 'タグ'];
        const conditionOptions = ['飲食自由', 'コース', '料理指定', 'ドリンク指定', '同伴1名', '同伴2名以上', '無償', '有償'];

        function save() {
            localStorage.setItem('pr_app_data', JSON.stringify(projects));
        }

        // --- 画面遷移 ---
        function changeView(view, id = null) {
            currentView = view;
            editingId = id;
            render();
            document.getElementById('main-content').scrollTo(0, 0);
        }

        // --- ヘルパー ---
        function getHeaderHTML() {
            return `
                <header class="px-6 py-6 flex justify-between items-center glass sticky top-0 z-40">
                    <div class="overflow-visible">
                        <h1 class="logo-text">PR管理</h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="changeView('trash')" class="p-2 bg-white/50 rounded-full shadow-sm">
                            <i data-lucide="trash-2" class="w-6 h-6 text-gray-700"></i>
                        </button>
                        <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-white bg-white/50 flex items-end justify-center">
                            <i data-lucide="user" class="w-10 h-10 text-gray-700"></i>
                        </div>
                    </div>
                </header>
            `;
        }

        function getCardHTML(p) {
            const media = mediaOptions.find(m => m.name === p.media) || mediaOptions[0];
            const status = statusOptions.find(s => s.value === p.status) || statusOptions[1];
            const isDone = p.status === 'completed';

            return `
                <div onclick="changeView('form', ${p.id})" class="glass rounded-2xl p-4 shadow-sm transition-all tap-active cursor-pointer ${isDone ? 'opacity-60' : ''}">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 rounded-full text-[10px] font-bold ${media.color}">${p.media}</span>
                            <span class="${status.color} text-[10px] px-2 py-1 rounded-full font-bold">${status.label}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="event.stopPropagation(); toggleComplete(${p.id})" class="${isDone ? 'text-green-500' : 'text-gray-300'}">
                                <i data-lucide="check-circle" class="w-5 h-5"></i>
                            </button>
                            <button onclick="event.stopPropagation(); moveToTrash(${p.id})" class="text-gray-400 hover:text-red-500">
                                <i data-lucide="trash-2" class="w-[18px] h-[18px]"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h3 class="text-base font-bold text-gray-800 flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-4 h-4 text-gray-400"></i>
                            ${p.shopName || '店舗名未入力'}
                        </h3>
                    </div>
                    <div class="flex items-center gap-4 mb-3 text-gray-700">
                        <div class="flex items-center gap-1 text-sm"><i data-lucide="calendar" class="w-3.5 h-3.5"></i> ${p.date || '未設定'}</div>
                        <div class="flex items-center gap-1 text-sm"><i data-lucide="clock" class="w-3.5 h-3.5"></i> ${p.time || '--:--'}</div>
                    </div>
                    <div class="space-y-2 border-t border-gray-100 pt-2">
                        <div class="flex flex-wrap gap-1">
                            <span class="text-[10px] font-bold text-gray-400 w-full uppercase">依頼内容</span>
                            ${p.requests.length ? p.requests.map(r => `<span class="bg-gray-100 px-2 py-0.5 rounded text-[10px] text-gray-600">${r}</span>`).join('') : '<span class="text-[10px] text-gray-300">なし</span>'}
                        </div>
                        <div class="flex flex-wrap gap-1">
                            <span class="text-[10px] font-bold text-gray-400 w-full uppercase">条件</span>
                            ${p.conditions.length ? p.conditions.map(c => `<span class="bg-blue-50 px-2 py-0.5 rounded text-[10px] text-blue-600">${c}</span>`).join('') : '<span class="text-[10px] text-gray-300">なし</span>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- アクション ---
        function toggleComplete(id) {
            const p = projects.find(x => x.id === id);
            p.status = p.status === 'completed' ? 'active' : 'completed';
            save(); render();
        }

        function moveToTrash(id) {
            projects.find(x => x.id === id).isDeleted = true;
            save(); render();
        }

        function restore(id) {
            projects.find(x => x.id === id).isDeleted = false;
            save(); render();
        }

        function handleForm(e) {
            e.preventDefault();
            const fd = new FormData(e.target);
            const data = {
                shopName: fd.get('shopName'),
                media: fd.get('media'),
                status: fd.get('status'),
                date: fd.get('date'),
                time: fd.get('time'),
                requests: fd.getAll('requests'),
                conditions: fd.getAll('conditions')
            };

            if (editingId) {
                const idx = projects.findIndex(x => x.id === editingId);
                projects[idx] = { ...projects[idx], ...data };
            } else {
                projects.unshift({ ...data, id: Date.now(), isDeleted: false });
            }
            save(); changeView('home');
        }

        // --- メインレンダリング ---
        function render() {
            const container = document.getElementById('main-content');
            const nav = document.getElementById('bottom-nav');
            
            // ナビゲーションの表示制御
            nav.style.display = (['home', 'calendar', 'list'].includes(currentView)) ? 'flex' : 'none';
            ['home', 'calendar', 'list'].forEach(v => {
                const el = document.getElementById(`nav-${v}`);
                if (el) el.className = `flex flex-col items-center gap-1 ${currentView === v ? 'active-nav' : 'inactive-nav'}`;
            });

            if (currentView === 'home') {
                const sorted = projects
                    .filter(p => !p.isDeleted)
                    .sort((a, b) => (a.date + a.time).localeCompare(b.date + b.time)); // 昇順

                container.innerHTML = `
                    ${getHeaderHTML()}
                    <div class="px-6 py-4 grid grid-cols-3 gap-3">
                        <div class="glass p-3 rounded-2xl text-center"><div class="text-[10px] font-bold text-gray-500">進行中</div><div class="text-xl font-black text-purple-600">${projects.filter(p => p.status === 'active' && !p.isDeleted).length}</div></div>
                        <div class="glass p-3 rounded-2xl text-center"><div class="text-[10px] font-bold text-gray-500">完了</div><div class="text-xl font-black text-green-500">${projects.filter(p => p.status === 'completed' && !p.isDeleted).length}</div></div>
                        <div class="glass p-3 rounded-2xl text-center"><div class="text-[10px] font-bold text-gray-500">総案件</div><div class="text-xl font-black text-gray-700">${projects.filter(p=>!p.isDeleted).length}</div></div>
                    </div>
                    <div class="p-4 space-y-4">
                        <h2 class="px-2 text-xs font-bold text-gray-500 uppercase">直近の予定（昇順）</h2>
                        ${sorted.slice(0, 10).map(getCardHTML).join('')}
                    </div>
                    <button onclick="changeView('form')" class="fixed bottom-24 right-8 w-14 h-14 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full shadow-lg flex items-center justify-center text-white tap-active z-50">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                `;
            } 
            else if (currentView === 'list') {
                const filtered = projects
                    .filter(p => !p.isDeleted)
                    .filter(p => listFilter === 'all' || p.status === listFilter)
                    .sort((a, b) => (b.date + b.time).localeCompare(a.date + a.time)); // 最新順

                container.innerHTML = `
                    ${getHeaderHTML()}
                    <div class="p-4 space-y-4">
                        <div class="flex gap-2 mb-2 overflow-x-auto no-scrollbar py-1">
                            <button onclick="listFilter='all'; render()" class="px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ${listFilter === 'all' ? 'bg-purple-600 text-white' : 'bg-white text-gray-500 shadow-sm'}">すべて</button>
                            ${statusOptions.map(s => `<button onclick="listFilter='${s.value}'; render()" class="px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ${listFilter === s.value ? 'bg-purple-600 text-white' : 'bg-white text-gray-500 shadow-sm'}">${s.label}</button>`).join('')}
                        </div>
                        ${filtered.map(getCardHTML).join('')}
                    </div>
                `;
            }
            else if (currentView === 'calendar') {
                const year = calMonth.getFullYear();
                const month = calMonth.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const startDay = new Date(year, month, 1).getDay();

                let daysHTML = '';
                for (let i = 0; i < startDay; i++) daysHTML += '<div></div>';
                for (let d = 1; d <= daysInMonth; d++) {
                    const dStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const has = projects.some(p => p.date === dStr && !p.isDeleted);
                    const isSel = selectedDate === dStr;
                    daysHTML += `<div onclick="selectedDate='${dStr}'; render()" class="h-10 flex flex-col items-center justify-center rounded-lg text-xs font-bold cursor-pointer ${isSel ? 'bg-purple-600 text-white shadow-md' : 'hover:bg-gray-100 text-gray-700'}">${d}${has ? `<div class="w-1 h-1 rounded-full mt-0.5 ${isSel ? 'bg-white' : 'bg-purple-400'}"></div>` : ''}</div>`;
                }

                const dayPrjs = projects.filter(p => p.date === selectedDate && !p.isDeleted);

                container.innerHTML = `
                    ${getHeaderHTML()}
                    <div class="p-6">
                        <div class="glass rounded-3xl p-6 shadow-xl">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-black">${year}.${String(month+1).padStart(2,'0')}</h2>
                                <div class="flex gap-2">
                                    <button onclick="calMonth.setMonth(calMonth.getMonth()-1); render()" class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center text-sm">←</button>
                                    <button onclick="calMonth.setMonth(calMonth.getMonth()+1); render()" class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center text-sm">→</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-7 gap-2 mb-2 text-center text-[10px] font-bold text-gray-400">
                                <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                            </div>
                            <div class="grid grid-cols-7 gap-2">${daysHTML}</div>
                        </div>
                        <div class="mt-6 space-y-4">
                            <h3 class="text-sm font-bold text-gray-600 px-2">${selectedDate.replace(/-/g, '.')} の案件</h3>
                            ${dayPrjs.length ? dayPrjs.map(getCardHTML).join('') : '<div class="text-center py-10 glass rounded-2xl text-gray-400 text-xs italic">案件はありません</div>'}
                        </div>
                    </div>
                `;
            }
            else if (currentView === 'form') {
                const p = editingId ? projects.find(x => x.id === editingId) : { shopName: '', media: 'Instagram', date: '', time: '', status: 'active', requests: [], conditions: [] };
                
                // 時間の選択肢 (10分単位)
                let timeOpts = '<option value="">未設定</option>';
                for(let h=0; h<24; h++) {
                    for(let m=0; m<60; m+=10) {
                        const t = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                        timeOpts += `<option value="${t}" ${p.time === t ? 'selected' : ''}>${t}</option>`;
                    }
                }

                container.innerHTML = `
                    <header class="p-6 flex items-center gap-4 glass sticky top-0 z-40">
                        <button onclick="changeView('home')"><i data-lucide="arrow-left"></i></button>
                        <h2 class="text-xl font-bold">${editingId ? '案件修正' : '新規登録'}</h2>
                    </header>
                    <form onsubmit="handleForm(event)" class="p-6 space-y-6 pb-32">
                        <section><label class="block text-sm font-bold text-gray-700 mb-2">店舗名</label>
                        <input type="text" name="shopName" value="${p.shopName}" required placeholder="店舗名を入力" class="w-full p-4 rounded-xl glass outline-none focus:ring-2 focus:ring-purple-400"></section>
                        
                        <section><label class="block text-sm font-bold text-gray-700 mb-2">ステータス</label>
                        <div class="grid grid-cols-2 gap-2">${statusOptions.map(s => `<button type="button" onclick="document.getElementById('form-st').value='${s.value}'; updateToggle(this)" class="p-3 rounded-xl text-xs font-bold ${p.status === s.value ? 'bg-purple-600 text-white' : 'bg-white text-gray-400 shadow-sm'}">${s.label}</button>`).join('')}</div>
                        <input type="hidden" name="status" id="form-st" value="${p.status}"></section>
                        
                        <section><label class="block text-sm font-bold text-gray-700 mb-2">媒体</label>
                        <div class="grid grid-cols-2 gap-2">${mediaOptions.map(m => `<button type="button" onclick="document.getElementById('form-md').value='${m.name}'; updateToggle(this, '${m.color}')" class="p-3 rounded-xl text-xs font-bold ${p.media === m.name ? m.color : 'bg-white text-gray-400 shadow-sm'}">${m.name}</button>`).join('')}</div>
                        <input type="hidden" name="media" id="form-md" value="${p.media}"></section>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <section><label class="block text-sm font-bold text-gray-700 mb-2">来店日</label><input type="date" name="date" value="${p.date}" class="w-full p-3 rounded-xl glass"></section>
                            <section><label class="block text-sm font-bold text-gray-700 mb-2">時間 (10分単位)</label><select name="time" class="w-full p-3 rounded-xl glass">${timeOpts}</select></section>
                        </div>

                        <section><label class="text-[10px] font-bold text-gray-400 uppercase mb-2 block">依頼内容</label>
                        <div class="grid grid-cols-2 gap-2">${requestOptions.map(r => `<label class="flex items-center gap-2 p-3 glass rounded-xl cursor-pointer"><input type="checkbox" name="requests" value="${r}" ${p.requests.includes(r) ? 'checked' : ''} class="w-4 h-4 accent-purple-600"><span class="text-[11px] font-medium">${r}</span></label>`).join('')}</div></section>
                        
                        <section><label class="text-[10px] font-bold text-gray-400 uppercase mb-2 block">条件</label>
                        <div class="grid grid-cols-2 gap-2">${conditionOptions.map(c => `<label class="flex items-center gap-2 p-3 glass rounded-xl cursor-pointer"><input type="checkbox" name="conditions" value="${c}" ${p.conditions.includes(c) ? 'checked' : ''} class="w-4 h-4 accent-blue-600"><span class="text-[11px] font-medium">${c}</span></label>`).join('')}</div></section>
                        
                        <button type="submit" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-2xl font-bold shadow-lg">保存する</button>
                    </form>
                `;
            }
            else if (currentView === 'trash') {
                const trashed = projects.filter(p => p.isDeleted);
                container.innerHTML = `
                    <header class="p-6 flex items-center gap-4 glass">
                        <button onclick="changeView('home')"><i data-lucide="arrow-left"></i></button>
                        <h2 class="text-xl font-bold flex items-center gap-2"><i data-lucide="trash-2"></i> ゴミ箱</h2>
                    </header>
                    <div class="p-4 space-y-4">
                        ${trashed.length ? trashed.map(p => `
                            <div class="glass rounded-2xl p-4 flex justify-between items-center opacity-70">
                                <div><div class="text-sm font-bold text-gray-700">${p.shopName}</div><div class="text-[10px] text-gray-500">${p.date}</div></div>
                                <button onclick="restore(${p.id})" class="px-4 py-2 bg-white rounded-lg text-xs font-bold text-purple-600 border border-purple-200">復元</button>
                            </div>
                        `).join('') : '<div class="text-center py-20 text-gray-400">空です</div>'}
                    </div>
                `;
            }
            lucide.createIcons();
        }

        function updateToggle(btn, color = 'bg-purple-600 text-white') {
            Array.from(btn.parentNode.children).forEach(b => b.className = 'p-3 rounded-xl text-xs font-bold bg-white text-gray-400 shadow-sm');
            btn.className = `p-3 rounded-xl text-xs font-bold ${color}`;
        }

        window.onload = render;
    </script>
</body>
</html>
