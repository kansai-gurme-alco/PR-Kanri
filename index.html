import React, { useState, useEffect, useRef } from 'react';
import { 
  Plus, 
  Trash2, 
  Calendar, 
  Clock, 
  CheckCircle2, 
  ChevronRight, 
  Home, 
  List,
  ArrowLeft,
  Search,
  CheckCircle,
  MapPin,
  Filter
} from 'lucide-react';

const App = () => {
  const [view, setView] = useState('home'); // 'home', 'calendar', 'list', 'add', 'trash'
  const [editingId, setEditingId] = useState(null);
  
  // カレンダーの動的表示用の状態
  const today = new Date();
  const [currentMonth, setCurrentMonth] = useState(new Date(today.getFullYear(), today.getMonth(), 1));
  const [selectedCalDate, setSelectedCalDate] = useState(today.toISOString().split('T')[0]);
  
  const [listFilter, setListFilter] = useState('all'); // 'all', 'active', 'completed', 'negotiating', 'cancelled'
  const [projects, setProjects] = useState([
    {
      id: 1,
      shopName: 'サンプルカフェ 渋谷店',
      media: 'Instagram',
      date: '2024-05-20',
      time: '12:00',
      status: 'active', // 来店予定
      requests: ['フィード', 'リール'],
      conditions: ['飲食自由', '無償'],
      isDeleted: false
    }
  ]);

  const [formData, setFormData] = useState({
    shopName: '',
    media: 'Instagram',
    date: '',
    time: '',
    status: 'active',
    requests: [],
    conditions: []
  });

  const mediaOptions = [
    { name: 'Instagram', color: 'bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600 text-white' },
    { name: 'TikTok', color: 'bg-black text-white' },
    { name: 'Toridori', color: 'bg-gradient-to-r from-pink-500 via-red-400 via-yellow-400 via-green-400 to-blue-500 text-white shadow-sm' },
    { name: 'ユニット', color: 'bg-yellow-300 text-gray-800' }
  ];

  const statusOptions = [
    { label: '条件交渉中', value: 'negotiating', color: 'bg-blue-100 text-blue-600' },
    { label: '来店予定', value: 'active', color: 'bg-purple-100 text-purple-600' },
    { label: '完了', value: 'completed', color: 'bg-green-100 text-green-600' },
    { label: '頓挫', value: 'cancelled', color: 'bg-red-100 text-red-600' }
  ];

  const requestOptions = [
    { label: 'フィード', value: 'feed' },
    { label: 'リール', value: 'reels' },
    { label: 'Google', value: 'google' },
    { label: 'タイアップ', value: 'tieup' },
    { label: 'インサイト', value: 'insight' },
    { label: '食べログ', value: 'tabelog' },
    { label: 'リンク', value: 'link' },
    { label: 'タグ', value: 'hashtag' }
  ];

  const conditionOptions = [
    { label: '飲食自由', value: 'free_eat' },
    { label: 'コース', value: 'course' },
    { label: '料理指定', value: 'food_spec' },
    { label: 'ドリンク指定', value: 'drink_spec' },
    { label: '同伴1名', value: 'plus1' },
    { label: '同伴2名以上', value: 'plus2' },
    { label: '無償', value: 'free' },
    { label: '有償', value: 'paid' }
  ];

  // 時間の選択肢を10分単位で生成
  const timeOptions = [];
  for (let h = 0; h < 24; h++) {
    for (let m = 0; m < 60; m += 10) {
      timeOptions.push(`${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`);
    }
  }

  const toggleSelection = (field, item) => {
    setFormData(prev => ({
      ...prev,
      [field]: prev[field].includes(item) 
        ? prev[field].filter(i => i !== item) 
        : [...prev[field], item]
    }));
  };

  const handleEdit = (project) => {
    setEditingId(project.id);
    setFormData({
      shopName: project.shopName || '',
      media: project.media,
      date: project.date,
      time: project.time,
      status: project.status || 'active',
      requests: [...project.requests],
      conditions: [...project.conditions]
    });
    setView('add');
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (editingId) {
      setProjects(projects.map(p => 
        p.id === editingId ? { ...p, ...formData } : p
      ));
    } else {
      const newProject = {
        ...formData,
        id: Date.now(),
        isDeleted: false
      };
      setProjects([newProject, ...projects]);
    }
    setView('home');
    resetForm();
  };

  const resetForm = () => {
    setEditingId(null);
    setFormData({ shopName: '', media: 'Instagram', date: '', time: '', status: 'active', requests: [], conditions: [] });
  };

  const toggleStatus = (e, id) => {
    e.stopPropagation();
    setProjects(projects.map(p => 
      p.id === id ? { ...p, status: p.status === 'completed' ? 'active' : 'completed' } : p
    ));
  };

  const deleteProject = (e, id) => {
    e.stopPropagation();
    setProjects(projects.map(p => p.id === id ? { ...p, isDeleted: true } : p));
  };

  const restoreProject = (id) => {
    setProjects(projects.map(p => p.id === id ? { ...p, isDeleted: false } : p));
  };

  const totalCount = projects.length;
  const activeCount = projects.filter(p => p.status === 'active' && !p.isDeleted).length;
  const completedCount = projects.filter(p => p.status === 'completed' && !p.isDeleted).length;

  const getMediaStyle = (mediaName) => {
    const opt = mediaOptions.find(o => o.name === mediaName);
    return opt ? opt.color : 'bg-gray-200';
  };

  const getStatusLabel = (statusValue) => {
    const opt = statusOptions.find(o => o.value === statusValue);
    return opt ? opt : { label: statusValue, color: 'bg-gray-100 text-gray-600' };
  };

  // ソートとフィルタリングを適用したリスト
  // ホーム画面用：今日に近い順（昇順）
  const getHomeSortedProjects = () => {
    const todayStr = new Date().toISOString().split('T')[0];
    return projects
      .filter(p => !p.isDeleted)
      .sort((a, b) => {
        // 日付で比較（昇順：古い（今日に近い）順）
        if (a.date !== b.date) return a.date.localeCompare(b.date);
        return a.time.localeCompare(b.time);
      });
  };

  // 通常リスト用：フィルタリング適用
  const getFilteredAndSortedProjects = () => {
    return projects
      .filter(p => !p.isDeleted)
      .filter(p => listFilter === 'all' || p.status === listFilter)
      .sort((a, b) => {
        if (a.date !== b.date) return b.date.localeCompare(a.date);
        return b.time.localeCompare(a.time);
      });
  };

  // カレンダー操作用関数
  const changeMonth = (offset) => {
    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + offset, 1));
  };

  const ProjectCard = ({ project }) => {
    const statusInfo = getStatusLabel(project.status);
    return (
      <div 
        onClick={() => handleEdit(project)}
        className={`bg-white/70 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-white/40 transition-all active:scale-[0.98] cursor-pointer ${project.status === 'completed' ? 'opacity-60' : ''}`}
      >
        <div className="flex justify-between items-start mb-3">
          <div className="flex items-center gap-2">
            <span className={`px-3 py-1 rounded-full text-[10px] font-bold ${getMediaStyle(project.media)}`}>
              {project.media}
            </span>
            <span className={`${statusInfo.color} text-[10px] px-2 py-1 rounded-full font-bold`}>
              {statusInfo.label}
            </span>
          </div>
          <div className="flex gap-2">
            <button onClick={(e) => toggleStatus(e, project.id)} className={`${project.status === 'completed' ? 'text-green-500' : 'text-gray-300'} hover:text-green-400`}>
              <CheckCircle size={20} />
            </button>
            <button onClick={(e) => deleteProject(e, project.id)} className="text-gray-400 hover:text-red-500">
              <Trash2 size={18} />
            </button>
          </div>
        </div>

        <div className="mb-3">
          <h3 className="text-base font-bold text-gray-800 flex items-center gap-1">
            <MapPin size={16} className="text-gray-400" />
            {project.shopName || '店舗名未入力'}
          </h3>
        </div>
        
        <div className="flex items-center gap-4 mb-3 text-gray-700">
          <div className="flex items-center gap-1">
            <Calendar size={14} />
            <span className="text-sm">{project.date || '未設定'}</span>
          </div>
          <div className="flex items-center gap-1">
            <Clock size={14} />
            <span className="text-sm">{project.time || '--:--'}</span>
          </div>
        </div>

        <div className="space-y-2 border-t border-gray-100 pt-2">
          <div className="flex flex-wrap gap-1">
            <span className="text-[10px] font-bold text-gray-400 w-full uppercase">依頼内容</span>
            {project.requests.length > 0 ? project.requests.map((r, idx) => (
              <span key={`${project.id}-req-${idx}`} className="bg-gray-100/80 px-2 py-0.5 rounded text-[10px] text-gray-600">{r}</span>
            )) : <span className="text-[10px] text-gray-300 italic">なし</span>}
          </div>
          <div className="flex flex-wrap gap-1">
            <span className="text-[10px] font-bold text-gray-400 w-full uppercase">条件</span>
            {project.conditions.length > 0 ? project.conditions.map((c, idx) => (
              <span key={`${project.id}-cond-${idx}`} className="bg-blue-50/80 px-2 py-0.5 rounded text-[10px] text-blue-600">{c}</span>
            )) : <span className="text-[10px] text-gray-300 italic">なし</span>}
          </div>
        </div>
      </div>
    );
  };

  const Header = () => (
    <header className="px-6 py-6 flex justify-between items-center bg-white/30 backdrop-blur-md sticky top-0 z-10">
      <div className="flex items-center overflow-visible">
        <h1 className="text-[28px] font-[1000] italic tracking-tight leading-none bg-gradient-to-tr from-[#f9ce34] via-[#ee2a7b] to-[#6228d7] bg-clip-text text-transparent filter drop-shadow-sm py-1 pr-2" style={{ fontFamily: 'system-ui, -apple-system, sans-serif' }}>
          PR管理
        </h1>
      </div>
      <div className="flex items-center gap-4">
        <button onClick={() => setView('trash')} className="p-2 bg-white/50 rounded-full hover:bg-white/80 transition shadow-sm">
          <Trash2 size={24} className="text-gray-700" />
        </button>
        <div className="w-12 h-12 rounded-full overflow-hidden border-2 border-white bg-white/50 flex items-end justify-center">
          <svg viewBox="0 0 24 24" className="w-10 h-10 text-gray-700" fill="none" stroke="currentColor" strokeWidth="1.5">
            <path d="M10 20l2-4h4l2 4M6 20l2-8 2-2 4 2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
        </div>
      </div>
    </header>
  );

  const StatsBar = () => (
    <div className="px-6 py-4 grid grid-cols-3 gap-3">
      <div className="bg-white/60 backdrop-blur-sm p-3 rounded-2xl text-center shadow-sm border border-white">
        <div className="text-[10px] text-gray-500 font-bold mb-1">進行中</div>
        <div className="text-xl font-black text-purple-600">{activeCount}</div>
      </div>
      <div className="bg-white/60 backdrop-blur-sm p-3 rounded-2xl text-center shadow-sm border border-white">
        <div className="text-[10px] text-gray-500 font-bold mb-1">完了</div>
        <div className="text-xl font-black text-green-500">{completedCount}</div>
      </div>
      <div className="bg-white/60 backdrop-blur-sm p-3 rounded-2xl text-center shadow-sm border border-white">
        <div className="text-[10px] text-gray-500 font-bold mb-1">総案件</div>
        <div className="text-xl font-black text-gray-700">{totalCount}</div>
      </div>
    </div>
  );

  const Navigation = () => (
    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/80 backdrop-blur-lg border-t border-gray-100 flex justify-around items-center py-3 px-4 z-20">
      <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1 ${view === 'home' ? 'text-purple-600' : 'text-gray-400'}`}>
        <Home size={24} />
        <span className="text-[10px] font-bold">ホーム</span>
      </button>
      <button onClick={() => setView('calendar')} className={`flex flex-col items-center gap-1 ${view === 'calendar' ? 'text-purple-600' : 'text-gray-400'}`}>
        <Calendar size={24} />
        <span className="text-[10px] font-bold">カレンダー</span>
      </button>
      <button onClick={() => setView('list')} className={`flex flex-col items-center gap-1 ${view === 'list' ? 'text-purple-600' : 'text-gray-400'}`}>
        <List size={24} />
        <span className="text-[10px] font-bold">リスト</span>
      </button>
    </nav>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 font-sans text-gray-900 max-w-md mx-auto shadow-2xl relative overflow-hidden pb-20">
      <div className="absolute -top-20 -left-20 w-64 h-64 bg-pink-300 rounded-full blur-[100px] opacity-30 animate-pulse"></div>
      <div className="absolute top-1/2 -right-20 w-80 h-80 bg-purple-300 rounded-full blur-[120px] opacity-30"></div>
      
      <div className="relative h-screen overflow-y-auto no-scrollbar">
        {view === 'home' && (
          <>
            <Header />
            <StatsBar />
            <div className="p-4 space-y-4">
              <h2 className="px-2 text-xs font-bold text-gray-500 uppercase tracking-wider">直近の予定（日付の近い順）</h2>
              {getHomeSortedProjects().slice(0, 10).map(p => <ProjectCard key={`home-proj-${p.id}`} project={p} />)}
            </div>
            <button 
              onClick={() => { resetForm(); setView('add'); }}
              className="fixed bottom-24 right-8 w-14 h-14 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-110 transition-transform active:scale-95 z-30"
            >
              <Plus size={32} />
            </button>
          </>
        )}

        {view === 'list' && (
          <>
            <Header />
            <div className="p-4 space-y-4">
              <div className="relative mb-2">
                <Search className="absolute left-3 top-3 text-gray-400" size={18} />
                <input type="text" placeholder="案件を検索..." className="w-full p-3 pl-10 rounded-xl bg-white/60 border-none shadow-sm" />
              </div>
              
              <div className="flex gap-2 mb-4 overflow-x-auto no-scrollbar py-1">
                {[
                  { label: 'すべて', value: 'all' },
                  ...statusOptions
                ].map(filter => (
                  <button
                    key={`filter-${filter.value}`}
                    onClick={() => setListFilter(filter.value)}
                    className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition shadow-sm ${listFilter === filter.value ? 'bg-purple-600 text-white' : 'bg-white text-gray-500'}`}
                  >
                    {filter.label}
                  </button>
                ))}
              </div>

              {getFilteredAndSortedProjects().map(p => <ProjectCard key={`list-proj-${p.id}`} project={p} />)}
            </div>
          </>
        )}

        {view === 'calendar' && (
          <>
            <Header />
            <div className="p-6">
              <div className="bg-white/70 backdrop-blur-md rounded-3xl p-6 shadow-xl border border-white">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-black italic">
                    {currentMonth.getFullYear()}.{String(currentMonth.getMonth() + 1).padStart(2, '0')}
                  </h2>
                  <div className="flex gap-2">
                    <button onClick={() => changeMonth(-1)} className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200">←</button>
                    <button onClick={() => changeMonth(1)} className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200">→</button>
                  </div>
                </div>
                <div className="grid grid-cols-7 gap-2 mb-2">
                  {['S','M','T','W','T','F','S'].map((d, idx) => (
                    <div key={`day-header-${idx}`} className="text-center text-[10px] font-bold text-gray-400">
                      {d}
                    </div>
                  ))}
                </div>
                <div className="grid grid-cols-7 gap-2">
                  {(() => {
                    const year = currentMonth.getFullYear();
                    const month = currentMonth.getMonth();
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    const firstDay = new Date(year, month, 1).getDay();
                    
                    const calendarCells = [];
                    for (let i = 0; i < firstDay; i++) {
                      calendarCells.push(<div key={`empty-${i}`} className="h-10"></div>);
                    }
                    
                    for (let dayNum = 1; dayNum <= daysInMonth; dayNum++) {
                      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayNum).padStart(2, '0')}`;
                      const dayProjects = projects.filter(p => p.date === dateStr && !p.isDeleted);
                      const hasProject = dayProjects.length > 0;
                      const isSelected = selectedCalDate === dateStr;
                      
                      calendarCells.push(
                        <div 
                          key={`cal-day-${dayNum}`} 
                          onClick={() => setSelectedCalDate(dateStr)}
                          className={`h-10 flex flex-col items-center justify-center rounded-lg text-xs font-bold transition cursor-pointer ${isSelected ? 'bg-purple-600 text-white scale-110 shadow-md' : 'hover:bg-purple-50 text-gray-700'}`}
                        >
                          {dayNum}
                          {hasProject && <div className={`w-1 h-1 rounded-full mt-1 ${isSelected ? 'bg-white' : 'bg-purple-400'}`}></div>}
                        </div>
                      );
                    }
                    return calendarCells;
                  })()}
                </div>
              </div>
              <div className="mt-6 space-y-4">
                <div className="flex justify-between items-center px-2">
                  <h3 className="text-sm font-bold text-gray-600">
                    {selectedCalDate.replace(/-/g, '.')} の案件
                  </h3>
                  <span className="text-[10px] bg-white/50 px-2 py-1 rounded-full text-gray-400 font-bold">
                    {projects.filter(p => p.date === selectedCalDate && !p.isDeleted).length}件
                  </span>
                </div>
                {projects.filter(p => p.date === selectedCalDate && !p.isDeleted).length > 0 ? (
                  projects.filter(p => p.date === selectedCalDate && !p.isDeleted).map(p => <ProjectCard key={`cal-list-${p.id}`} project={p} />)
                ) : (
                  <div className="text-center py-10 bg-white/30 rounded-2xl border border-dashed border-white/50 text-gray-400 text-xs italic">
                    予定はありません
                  </div>
                )}
              </div>
            </div>
          </>
        )}

        {view === 'add' && (
          <div className="flex flex-col h-full bg-white/40">
            <header className="p-6 flex items-center gap-4 bg-white/30 sticky top-0 z-10">
              <button onClick={() => { setView('home'); resetForm(); }}><ArrowLeft /></button>
              <h2 className="text-xl font-bold">{editingId ? '案件を修正' : '新規案件登録'}</h2>
            </header>

            <form onSubmit={handleSubmit} className="p-6 space-y-6 overflow-y-auto pb-32">
              <section>
                <label className="block text-sm font-bold text-gray-700 mb-2">店舗名</label>
                <input 
                  type="text" 
                  placeholder="店舗名を入力してください"
                  className="w-full p-4 rounded-xl bg-white border-none shadow-sm focus:ring-2 focus:ring-purple-400"
                  value={formData.shopName}
                  onChange={(e) => setFormData(f => ({...f, shopName: e.target.value}))}
                />
              </section>

              <section>
                <label className="block text-sm font-bold text-gray-700 mb-2">ステータス</label>
                <div className="grid grid-cols-2 gap-2">
                  {statusOptions.map(opt => (
                    <button
                      key={`status-${opt.value}`}
                      type="button"
                      onClick={() => setFormData(f => ({...f, status: opt.value}))}
                      className={`p-3 rounded-xl text-sm font-bold transition-all duration-200 shadow-sm ${formData.status === opt.value ? 'bg-purple-600 text-white' : 'bg-white text-gray-500'}`}
                    >
                      {opt.label}
                    </button>
                  ))}
                </div>
              </section>

              <section>
                <label className="block text-sm font-bold text-gray-700 mb-2">媒体</label>
                <div className="grid grid-cols-2 gap-2">
                  {mediaOptions.map(opt => (
                    <button
                      key={`media-${opt.name}`}
                      type="button"
                      onClick={() => setFormData(f => ({...f, media: opt.name}))}
                      className={`p-3 rounded-xl text-sm font-bold transition-all duration-200 ${formData.media === opt.name ? opt.color : 'bg-white text-gray-500'}`}
                    >
                      {opt.name}
                    </button>
                  ))}
                </div>
              </section>

              <section className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">来店日</label>
                  <input 
                    type="date" 
                    className="w-full p-3 rounded-xl bg-white border-none shadow-sm focus:ring-2 focus:ring-purple-400"
                    value={formData.date}
                    onChange={(e) => setFormData(f => ({...f, date: e.target.value}))}
                  />
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">時間</label>
                  <select 
                    className="w-full p-3 rounded-xl bg-white border-none shadow-sm focus:ring-2 focus:ring-purple-400"
                    value={formData.time}
                    onChange={(e) => setFormData(f => ({...f, time: e.target.value}))}
                  >
                    <option value="">--:--</option>
                    {timeOptions.map((t) => (
                      <option key={`time-opt-${t}`} value={t}>{t}</option>
                    ))}
                  </select>
                </div>
              </section>

              <section className="space-y-2">
                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-wider">依頼内容（TODO）</label>
                <div className="grid grid-cols-2 gap-2">
                  {requestOptions.map(opt => (
                    <label key={`req-opt-${opt.value}`} className="flex items-center gap-2 p-3 bg-white/60 backdrop-blur-sm rounded-xl cursor-pointer hover:bg-white/80 transition shadow-sm active:scale-95">
                      <input 
                        type="checkbox" 
                        checked={formData.requests.includes(opt.label)}
                        onChange={() => toggleSelection('requests', opt.label)}
                        className="w-4 h-4 rounded text-red-500 focus:ring-red-500 accent-red-500" 
                      />
                      <span className="text-[11px] font-medium">{opt.label}</span>
                    </label>
                  ))}
                </div>
              </section>

              <section className="space-y-2">
                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-wider">条件</label>
                <div className="grid grid-cols-2 gap-2">
                  {conditionOptions.map(opt => (
                    <label key={`cond-opt-${opt.value}`} className="flex items-center gap-2 p-3 bg-white/60 backdrop-blur-sm rounded-xl cursor-pointer hover:bg-white/80 transition shadow-sm active:scale-95">
                      <input 
                        type="checkbox" 
                        checked={formData.conditions.includes(opt.label)}
                        onChange={() => toggleSelection('conditions', opt.label)}
                        className="w-4 h-4 rounded text-red-500 focus:ring-red-500 accent-red-500" 
                      />
                      <span className="text-[11px] font-medium">{opt.label}</span>
                    </label>
                  ))}
                </div>
              </section>

              <button 
                type="submit"
                className="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-2xl font-bold shadow-lg shadow-purple-200"
              >
                {editingId ? '修正内容を保存' : '登録する'}
              </button>
            </form>
          </div>
        )}

        {view === 'trash' && (
          <div className="flex flex-col h-full bg-gray-50/50">
            <header className="p-6 flex items-center gap-4 bg-white/30">
              <button onClick={() => setView('home')}><ArrowLeft /></button>
              <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2"><Trash2 size={20} /> ゴミ箱</h2>
            </header>
            <main className="p-4 flex-1 space-y-4 pb-24">
              {projects.filter(p => p.isDeleted).length === 0 ? (
                <div className="text-center py-20 text-gray-400">ゴミ箱は空です</div>
              ) : (
                projects.filter(p => p.isDeleted).map(project => (
                  <div key={`trash-proj-${project.id}`} className="bg-white/50 backdrop-blur-sm rounded-2xl p-4 shadow-sm border border-gray-200 flex justify-between items-center opacity-70">
                    <div>
                      <div className="text-sm font-bold text-gray-700">{project.shopName || '店舗名なし'}</div>
                      <span className={`px-2 py-0.5 rounded-full text-[10px] ${getMediaStyle(project.media)} mb-1 inline-block`}>{project.media}</span>
                      <div className="text-[10px] text-gray-500 font-bold">{project.date || '日付未設定'}</div>
                    </div>
                    <button onClick={() => restoreProject(project.id)} className="px-4 py-2 bg-white rounded-lg text-xs font-bold text-purple-600 border border-purple-200 hover:bg-purple-50">復元</button>
                  </div>
                ))
              )}
            </main>
          </div>
        )}
      </div>

      {(view === 'home' || view === 'calendar' || view === 'list') && <Navigation />}

      <style>{`
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `}</style>
    </div>
  );
};

export default App;
